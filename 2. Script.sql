-- ================================================
-- BASE DE DATOS: SISTEMA DE GESTION DE STOCK DE ROPA
-- ================================================

-- TABLA DE MARCAS DE ROPA
CREATE TABLE MARCA (
    ID_MARCA NUMBER NOT NULL,
    NOMBRE VARCHAR2(50) NOT NULL UNIQUE,
    CONSTRAINT PK_MARCA PRIMARY KEY (ID_MARCA)
);

-- TABLA DE PROVEEDORES
CREATE TABLE PROVEEDOR (
    ID_PROVEEDOR NUMBER NOT NULL,
    NOMBRE VARCHAR2(100) NOT NULL,
    TELEFONO VARCHAR2(20) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    CONSTRAINT PK_PROVEEDOR PRIMARY KEY (ID_PROVEEDOR),
    CONSTRAINT CHK_EMAIL_FORMAT CHECK (EMAIL LIKE '%@%')
);

-- TABLA DE MODELOS (INDEPENDIENTE)
CREATE TABLE MODELO (
    ID_MODELO NUMBER NOT NULL,
    NOMBRE VARCHAR2(100) NOT NULL,
    DESCRIPCION VARCHAR2(200),
    CONSTRAINT PK_MODELO PRIMARY KEY (ID_MODELO)
);

-- TABLA DE PRODUCTOS (AHORA RELACIONADA A MODELO)
CREATE TABLE PRODUCTO (
    ID_PRODUCTO NUMBER NOT NULL,
    ID_MARCA NUMBER NOT NULL,
    ID_MODELO NUMBER NOT NULL,
    NOMBRE VARCHAR2(100) NOT NULL,
    COLOR VARCHAR2(50) NOT NULL,
    GENERO VARCHAR2(10) NOT NULL,
    CONSTRAINT PK_PRODUCTO PRIMARY KEY (ID_PRODUCTO),
    CONSTRAINT FK_PRODUCTO_MARCA FOREIGN KEY (ID_MARCA) REFERENCES MARCA(ID_MARCA),
    CONSTRAINT FK_PRODUCTO_MODELO FOREIGN KEY (ID_MODELO) REFERENCES MODELO(ID_MODELO),
    CONSTRAINT CHK_GENERO CHECK (GENERO IN ('HOMBRE', 'MUJER', 'UNISEX'))
);

-- TABLA DE TALLAS
CREATE TABLE TALLA (
    ID_TALLA NUMBER NOT NULL,
    DESCRIPCION VARCHAR2(10) NOT NULL UNIQUE,
    CONSTRAINT PK_TALLA PRIMARY KEY (ID_TALLA)
);

-- TABLA DE STOCK (AHORA RELACIONADA DIRECTAMENTE A PRODUCTO)
CREATE TABLE STOCK (
    ID_STOCK NUMBER NOT NULL,
    ID_PRODUCTO NUMBER NOT NULL,
    ID_TALLA NUMBER NOT NULL,
    CANTIDAD NUMBER NOT NULL,
    CONSTRAINT PK_STOCK PRIMARY KEY (ID_STOCK),
    CONSTRAINT FK_STOCK_PRODUCTO FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO(ID_PRODUCTO) ON DELETE CASCADE,
    CONSTRAINT FK_STOCK_TALLA FOREIGN KEY (ID_TALLA) REFERENCES TALLA(ID_TALLA),
    CONSTRAINT UK_STOCK_PRODUCTO_TALLA UNIQUE (ID_PRODUCTO, ID_TALLA),
    CONSTRAINT CHK_CANTIDAD_POSITIVA CHECK (CANTIDAD >= 0)
);

-- TABLA DE PEDIDOS A PROVEEDORES
CREATE TABLE PEDIDO (
    ID_PEDIDO NUMBER NOT NULL,
    ID_PROVEEDOR NUMBER NOT NULL,
    FECHA DATE NOT NULL,
    ESTADO VARCHAR2(20) NOT NULL,
    CONSTRAINT PK_PEDIDO PRIMARY KEY (ID_PEDIDO),
    CONSTRAINT FK_PEDIDO_PROVEEDOR FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDOR(ID_PROVEEDOR),
    CONSTRAINT CHK_ESTADO CHECK (ESTADO IN ('PENDIENTE', 'RECIBIDO', 'CANCELADO'))
);

-- TABLA DETALLE DE PEDIDOS (AHORA RELACIONADA A PRODUCTO)
CREATE TABLE DETALLE_PEDIDO (
    ID_DETALLE NUMBER NOT NULL,
    ID_PEDIDO NUMBER NOT NULL,
    ID_PRODUCTO NUMBER NOT NULL,
    ID_TALLA NUMBER NOT NULL,
    CANTIDAD NUMBER NOT NULL,
    CONSTRAINT PK_DETALLE_PEDIDO PRIMARY KEY (ID_DETALLE),
    CONSTRAINT FK_DETALLE_PEDIDO_PEDIDO FOREIGN KEY (ID_PEDIDO) REFERENCES PEDIDO(ID_PEDIDO) ON DELETE CASCADE,
    CONSTRAINT FK_DETALLE_PEDIDO_PRODUCTO FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO(ID_PRODUCTO),
    CONSTRAINT FK_DETALLE_PEDIDO_TALLA FOREIGN KEY (ID_TALLA) REFERENCES TALLA(ID_TALLA),
    CONSTRAINT CHK_DETALLE_CANTIDAD_POSITIVA CHECK (CANTIDAD > 0)
);

-- ÍNDICES PARA MEJORAR RENDIMIENTO
CREATE INDEX IDX_PRODUCTO_MARCA ON PRODUCTO(ID_MARCA);
CREATE INDEX IDX_PRODUCTO_MODELO ON PRODUCTO(ID_MODELO);
CREATE INDEX IDX_STOCK_PRODUCTO ON STOCK(ID_PRODUCTO);
CREATE INDEX IDX_STOCK_TALLA ON STOCK(ID_TALLA);
CREATE INDEX IDX_PEDIDO_PROVEEDOR ON PEDIDO(ID_PROVEEDOR);
CREATE INDEX IDX_PEDIDO_FECHA ON PEDIDO(FECHA);
CREATE INDEX IDX_DETALLE_PEDIDO ON DETALLE_PEDIDO(ID_PEDIDO);

-- ================================================
-- INSERTS DE DATOS
-- ================================================

-- MARCAS
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (1, 'NIKE');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (2, 'ADIDAS');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (3, 'PUMA');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (4, 'LEVIS');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (5, 'H&M');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (6, 'ZARA');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (7, 'GUESS');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (8, 'UNDER ARMOUR');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (9, 'COLUMBIA');
INSERT INTO MARCA (ID_MARCA, NOMBRE) VALUES (10, 'UNIQLO');

-- PROVEEDORES
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (1, 'DISTRIBUIDORA SPORT', '123456789', 'contacto@sport.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (2, 'PROVEEDOR TEXTIL', '987654321', 'ventas@textil.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (3, 'ROPA IMPORTADA', '555666777', 'info@importada.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (4, 'MAYORISTA MODA', '999888777', 'moda@mayorista.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (5, 'GLOBAL FASHION', '112233445', 'ventas@globalfashion.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (6, 'SPORT LINE', '223344556', 'contacto@sportline.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (7, 'URBAN STYLE', '334455667', 'urban@style.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (8, 'TEXTILES PREMIUM', '445566778', 'premium@textiles.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (9, 'ROPA OUTLET', '556677889', 'outlet@ropa.com');
INSERT INTO PROVEEDOR (ID_PROVEEDOR, NOMBRE, TELEFONO, EMAIL) VALUES (10, 'FABRICA DIRECTA', '667788990', 'directa@fabrica.com');

-- MODELOS (AHORA INDEPENDIENTES Y REUTILIZABLES)
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (1, 'AIR MAX', 'Zapatilla deportiva con tecnología Air Max');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (2, 'AIR FORCE', 'Zapatilla clásica de basketball');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (3, 'POLO BÁSICO', 'Polo deportivo de corte clásico');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (4, 'HOODIE CLÁSICO', 'Sudadera con capucha estilo casual');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (5, 'JEANS SLIM', 'Pantalón de mezclilla corte ajustado');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (6, 'CAMISETA BÁSICA', 'Camiseta de algodón básica');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (7, 'CHAQUETA MODERNA', 'Chaqueta de corte contemporáneo');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (8, 'VESTIDO FLORAL', 'Vestido con estampado de flores');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (9, 'SHORT DEPORTIVO', 'Short para actividades deportivas');
INSERT INTO MODELO (ID_MODELO, NOMBRE, DESCRIPCION) VALUES (10, 'PARKA INVIERNO', 'Chaqueta impermeable para clima frío');

-- TALLAS
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (1, 'XS');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (2, 'S');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (3, 'M');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (4, 'L');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (5, 'XL');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (6, 'XXL');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (7, '36');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (8, '38');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (9, '40');
INSERT INTO TALLA (ID_TALLA, DESCRIPCION) VALUES (10, '42');

-- PRODUCTOS (AHORA CON RELACIÓN A MODELO Y INCLUYENDO COLOR)
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (1, 1, 1, 'ZAPATILLAS AIR MAX 90', 'NEGRO', 'HOMBRE');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (2, 1, 2, 'ZAPATILLAS AIR FORCE 1', 'BLANCO', 'HOMBRE');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (3, 2, 3, 'POLO SPORT ADIDAS', 'AZUL', 'MUJER');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (4, 3, 4, 'HOODIE PUMA CLASSIC', 'GRIS', 'HOMBRE');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (5, 4, 5, 'JEANS LEVIS SLIM', 'AZUL', 'MUJER');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (6, 5, 6, 'CAMISETA H&M BÁSICA', 'BLANCO', 'UNISEX');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (7, 6, 7, 'CHAQUETA ZARA MODERNA', 'NEGRO', 'MUJER');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (8, 7, 8, 'VESTIDO GUESS FLORAL', 'ROJO', 'MUJER');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (9, 8, 9, 'SHORT UNDER ARMOUR RUN', 'NEGRO', 'HOMBRE');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (10, 9, 10, 'PARKA COLUMBIA EXTREME', 'VERDE', 'UNISEX');

-- Ejemplos adicionales para mostrar reutilización de modelos
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (11, 6, 8, 'VESTIDO ZARA FLORAL', 'AZUL', 'MUJER');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (12, 5, 8, 'VESTIDO H&M FLORAL', 'ROSA', 'MUJER');
INSERT INTO PRODUCTO (ID_PRODUCTO, ID_MARCA, ID_MODELO, NOMBRE, COLOR, GENERO) VALUES (13, 2, 1, 'ZAPATILLAS ADIDAS AIR MAX', 'BLANCO', 'MUJER');

-- STOCK
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (1, 1, 3, 50);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (2, 1, 4, 30);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (3, 2, 2, 20);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (4, 3, 3, 40);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (5, 4, 4, 15);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (6, 5, 2, 25);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (7, 6, 3, 60);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (8, 7, 4, 10);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (9, 8, 2, 35);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (10, 9, 5, 12);

-- Stock para los productos adicionales
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (11, 11, 2, 25);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (12, 12, 3, 18);
INSERT INTO STOCK (ID_STOCK, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (13, 13, 3, 22);

-- PEDIDOS
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (1, 1, DATE '2023-01-10', 'PENDIENTE');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (2, 2, DATE '2023-02-15', 'RECIBIDO');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (3, 3, DATE '2023-03-05', 'PENDIENTE');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (4, 4, DATE '2023-03-20', 'RECIBIDO');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (5, 5, DATE '2023-04-02', 'PENDIENTE');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (6, 6, DATE '2023-04-18', 'RECIBIDO');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (7, 7, DATE '2023-05-01', 'PENDIENTE');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (8, 8, DATE '2023-05-22', 'RECIBIDO');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (9, 9, DATE '2023-06-15', 'PENDIENTE');
INSERT INTO PEDIDO (ID_PEDIDO, ID_PROVEEDOR, FECHA, ESTADO) VALUES (10, 10, DATE '2023-07-01', 'RECIBIDO');

-- DETALLE DE PEDIDOS
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (1, 1, 1, 3, 20);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (2, 1, 2, 2, 15);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (3, 2, 3, 3, 25);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (4, 3, 4, 4, 10);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (5, 4, 5, 2, 30);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (6, 5, 6, 3, 40);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (7, 6, 7, 4, 15);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (8, 7, 8, 2, 20);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (9, 8, 9, 3, 35);
INSERT INTO DETALLE_PEDIDO (ID_DETALLE, ID_PEDIDO, ID_PRODUCTO, ID_TALLA, CANTIDAD) VALUES (10, 9, 10, 5, 12);

COMMIT;